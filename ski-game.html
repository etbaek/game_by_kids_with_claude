<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìŠ¤í‚¤ ê²Œì„ - Ski Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .game-container {
            text-align: center;
            position: relative;
        }

        h1 {
            color: #fff;
            margin-bottom: 10px;
            font-size: 2rem;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 10px;
            color: #fff;
        }

        .stat {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 20px;
            border-radius: 10px;
        }

        .stat-label {
            font-size: 0.7rem;
            color: #aaa;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .distance .stat-value { color: #00ff88; }
        .speed .stat-value { color: #ffaa00; }
        .best .stat-value { color: #ffd700; }

        canvas {
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(100, 200, 255, 0.3);
            max-width: 100%;
            height: auto;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }

        .control-btn {
            width: 90px;
            height: 60px;
            font-size: 1.5rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.1s;
            user-select: none;
            color: #fff;
            -webkit-tap-highlight-color: transparent;
        }

        /* ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 500px) {
            h1 { font-size: 1.5rem; }
            .stats { gap: 10px; }
            .stat { padding: 5px 12px; }
            .stat-label { font-size: 0.6rem; }
            .stat-value { font-size: 1rem; }
            .control-btn {
                width: 120px;
                height: 70px;
                font-size: 2rem;
            }
            .controls { gap: 20px; }
            .instructions { font-size: 0.75rem; }
            .back-btn {
                padding: 8px 15px;
                font-size: 0.8rem;
                top: 10px;
                left: 10px;
            }
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .left-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .right-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .instructions {
            color: #888;
            margin-top: 12px;
            font-size: 0.85rem;
        }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 10px 20px;
            font-size: 0.9rem;
            border-radius: 25px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s;
            z-index: 1000;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .game-over, .start-screen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            z-index: 100;
        }

        .game-over {
            border: 2px solid #ff4444;
            display: none;
        }

        .start-screen {
            border: 2px solid #00aaff;
        }

        .game-over h2 { color: #ff4444; }
        .start-screen h2 { color: #00aaff; }

        h2 {
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .start-screen p, .game-over p {
            color: #ccc;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .final-distance {
            color: #00ff88;
            font-size: 2.5rem;
            font-weight: bold;
            margin: 15px 0;
        }

        .btn {
            background: linear-gradient(135deg, #00aaff 0%, #0077cc 100%);
            color: #fff;
            border: none;
            padding: 12px 35px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 10px;
        }

        .btn:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-btn">ğŸ  ë‹¤ë¥¸ ê²Œì„ í•˜ê¸°</a>

    <div class="game-container">
        <h1>â›·ï¸ ìŠ¤í‚¤ ê²Œì„ â›·ï¸</h1>
        <div class="stats">
            <div class="stat distance">
                <div class="stat-label">ê±°ë¦¬</div>
                <div class="stat-value" id="distance">0m</div>
            </div>
            <div class="stat speed">
                <div class="stat-label">ì†ë„</div>
                <div class="stat-value" id="speed">0</div>
            </div>
            <div class="stat best">
                <div class="stat-label">ìµœê³ ê¸°ë¡</div>
                <div class="stat-value" id="best">0m</div>
            </div>
        </div>

        <canvas id="gameCanvas" width="400" height="550"></canvas>

        <div class="controls">
            <button class="control-btn left-btn" id="leftBtn">â¬…ï¸</button>
            <button class="control-btn right-btn" id="rightBtn">â¡ï¸</button>
        </div>

        <p class="instructions">â¬…ï¸ â¡ï¸ ë˜ëŠ” ğŸ‘† ë“œë˜ê·¸ë¡œ ì´ë™ | ğŸŒ²ğŸª¨ í”¼í•˜ê¸° | â­ +50ì  | â„ï¸ ì†ë„ ê°ì†Œ!</p>

        <div class="start-screen" id="startScreen">
            <h2>â›·ï¸ ìŠ¤í‚¤ ê²Œì„</h2>
            <p>
                ëˆˆ ë®ì¸ ìŠ¬ë¡œí”„ë¥¼ ë‚´ë ¤ê°€ìš”!<br><br>
                ğŸŒ² ë‚˜ë¬´ë¥¼ í”¼í•˜ì„¸ìš”!<br>
                ğŸª¨ ë°”ìœ„ë¥¼ í”¼í•˜ì„¸ìš”!<br>
                â­ ë³„ì„ ëª¨ìœ¼ë©´ +50ì !<br>
                â„ï¸ ëˆˆê²°ì •ì€ ì†ë„ ê°ì†Œ!<br><br>
                ì†ë„ê°€ ì ì  ë¹¨ë¼ì ¸ìš”!
            </p>
            <button class="btn" onclick="startGame()">ê²Œì„ ì‹œì‘</button>
        </div>

        <div class="game-over" id="gameOver">
            <h2>ğŸ’¥ ì¶©ëŒ!</h2>
            <p>ì´ë™ ê±°ë¦¬</p>
            <div class="final-distance" id="finalDistance">0m</div>
            <p>ìµœê³  ê¸°ë¡: <span id="bestRecord">0m</span></p>
            <button class="btn" onclick="restartGame()">ë‹¤ì‹œ ë„ì „</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // ëª¨ë°”ì¼ ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì •
        function resizeCanvas() {
            const maxWidth = Math.min(400, window.innerWidth - 30);
            const scale = maxWidth / 400;
            canvas.style.width = maxWidth + 'px';
            canvas.style.height = (550 * scale) + 'px';
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // í„°ì¹˜ ìŠ¤í¬ë¡¤ ë°©ì§€
        document.addEventListener('touchmove', function(e) {
            if (e.target === canvas) e.preventDefault();
        }, { passive: false });

        // ê²Œì„ ìƒíƒœ
        let gameRunning = false;
        let distance = 0;
        let speed = 5;
        let bestScore = parseInt(localStorage.getItem('skiBest') || '0');

        // í”Œë ˆì´ì–´
        const player = {
            x: canvas.width / 2,
            y: 120,
            width: 30,
            height: 40,
            targetX: canvas.width / 2,
            lean: 0
        };

        // ì¥ì• ë¬¼ & ì•„ì´í…œ
        let obstacles = [];
        let stars = [];
        let slowItems = [];
        let snowflakes = [];
        let skiTracks = [];
        let slowEffect = 0; // ì†ë„ ê°ì†Œ íš¨ê³¼ íƒ€ì´ë¨¸

        // ì…ë ¥
        const keys = { left: false, right: false };

        // ëˆˆì†¡ì´ ì´ˆê¸°í™”
        function initSnowflakes() {
            snowflakes = [];
            for (let i = 0; i < 50; i++) {
                snowflakes.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * 3 + 1,
                    speed: Math.random() * 2 + 1
                });
            }
        }

        // ì¥ì• ë¬¼ ìƒì„±
        function spawnObstacle() {
            const type = Math.random() > 0.4 ? 'tree' : 'rock';
            obstacles.push({
                x: Math.random() * (canvas.width - 40) + 20,
                y: canvas.height + 50,
                type: type,
                width: type === 'tree' ? 30 : 35,
                height: type === 'tree' ? 50 : 25
            });
        }

        // ë³„ ìƒì„±
        function spawnStar() {
            stars.push({
                x: Math.random() * (canvas.width - 30) + 15,
                y: canvas.height + 30,
                collected: false,
                rotation: 0
            });
        }

        // ì†ë„ ê°ì†Œ ì•„ì´í…œ ìƒì„±
        function spawnSlowItem() {
            slowItems.push({
                x: Math.random() * (canvas.width - 30) + 15,
                y: canvas.height + 30,
                collected: false,
                rotation: 0,
                pulse: 0
            });
        }

        // ìŠ¤í‚¤ ìêµ­ ìƒì„±
        function addSkiTrack() {
            skiTracks.push({
                x: player.x,
                y: player.y + player.height,
                opacity: 0.5
            });
            if (skiTracks.length > 50) {
                skiTracks.shift();
            }
        }

        // í”Œë ˆì´ì–´ ê·¸ë¦¬ê¸°
        function drawPlayer() {
            ctx.save();
            ctx.translate(player.x, player.y);
            ctx.rotate(player.lean * 0.15);

            // ìŠ¤í‚¤
            ctx.fillStyle = '#1a5f7a';
            ctx.beginPath();
            ctx.ellipse(-8, 35, 4, 18, -0.1, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.ellipse(8, 35, 4, 18, 0.1, 0, Math.PI * 2);
            ctx.fill();

            // ë‹¤ë¦¬
            ctx.fillStyle = '#2d3436';
            ctx.fillRect(-10, 15, 7, 20);
            ctx.fillRect(3, 15, 7, 20);

            // ëª¸í†µ (íŒ¨ë”© ì í¼)
            ctx.fillStyle = '#e74c3c';
            ctx.beginPath();
            ctx.ellipse(0, 5, 12, 15, 0, 0, Math.PI * 2);
            ctx.fill();

            // ì í¼ ì¤„ë¬´ëŠ¬
            ctx.fillStyle = '#c0392b';
            ctx.fillRect(-10, 0, 20, 4);

            // ë¨¸ë¦¬
            ctx.fillStyle = '#ffeaa7';
            ctx.beginPath();
            ctx.arc(0, -12, 10, 0, Math.PI * 2);
            ctx.fill();

            // í—¬ë©§
            ctx.fillStyle = '#0984e3';
            ctx.beginPath();
            ctx.arc(0, -14, 10, Math.PI, 0);
            ctx.fill();

            // ê³ ê¸€
            ctx.fillStyle = '#2d3436';
            ctx.fillRect(-8, -14, 16, 5);
            ctx.fillStyle = '#74b9ff';
            ctx.fillRect(-7, -13, 6, 3);
            ctx.fillRect(1, -13, 6, 3);

            // ìŠ¤í‚¤ í´
            ctx.strokeStyle = '#636e72';
            ctx.lineWidth = 2;
            // ì™¼ìª½ í´
            ctx.beginPath();
            ctx.moveTo(-15, 5);
            ctx.lineTo(-25, 40);
            ctx.stroke();
            // ì˜¤ë¥¸ìª½ í´
            ctx.beginPath();
            ctx.moveTo(15, 5);
            ctx.lineTo(25, 40);
            ctx.stroke();

            ctx.restore();
        }

        // ë‚˜ë¬´ ê·¸ë¦¬ê¸°
        function drawTree(x, y) {
            // ê·¸ë¦¼ì
            ctx.fillStyle = 'rgba(0,0,0,0.2)';
            ctx.beginPath();
            ctx.ellipse(x, y + 5, 20, 8, 0, 0, Math.PI * 2);
            ctx.fill();

            // ë‚˜ë¬´ ì¤„ê¸°
            ctx.fillStyle = '#5d4037';
            ctx.fillRect(x - 5, y - 15, 10, 20);

            // ë‚˜ë­‡ì (3ë‹¨)
            ctx.fillStyle = '#2e7d32';
            ctx.beginPath();
            ctx.moveTo(x, y - 55);
            ctx.lineTo(x - 18, y - 25);
            ctx.lineTo(x + 18, y - 25);
            ctx.fill();

            ctx.fillStyle = '#388e3c';
            ctx.beginPath();
            ctx.moveTo(x, y - 45);
            ctx.lineTo(x - 22, y - 15);
            ctx.lineTo(x + 22, y - 15);
            ctx.fill();

            ctx.fillStyle = '#43a047';
            ctx.beginPath();
            ctx.moveTo(x, y - 35);
            ctx.lineTo(x - 25, y - 5);
            ctx.lineTo(x + 25, y - 5);
            ctx.fill();

            // ëˆˆ
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.ellipse(x - 10, y - 40, 5, 3, -0.3, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.ellipse(x + 8, y - 30, 6, 3, 0.3, 0, Math.PI * 2);
            ctx.fill();
        }

        // ë°”ìœ„ ê·¸ë¦¬ê¸°
        function drawRock(x, y) {
            // ê·¸ë¦¼ì
            ctx.fillStyle = 'rgba(0,0,0,0.2)';
            ctx.beginPath();
            ctx.ellipse(x, y + 5, 22, 8, 0, 0, Math.PI * 2);
            ctx.fill();

            // ë°”ìœ„
            ctx.fillStyle = '#636e72';
            ctx.beginPath();
            ctx.moveTo(x - 18, y);
            ctx.lineTo(x - 12, y - 18);
            ctx.lineTo(x + 5, y - 22);
            ctx.lineTo(x + 18, y - 10);
            ctx.lineTo(x + 15, y);
            ctx.closePath();
            ctx.fill();

            // í•˜ì´ë¼ì´íŠ¸
            ctx.fillStyle = '#b2bec3';
            ctx.beginPath();
            ctx.moveTo(x - 5, y - 18);
            ctx.lineTo(x + 3, y - 20);
            ctx.lineTo(x + 8, y - 12);
            ctx.lineTo(x - 2, y - 10);
            ctx.closePath();
            ctx.fill();

            // ëˆˆ
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.ellipse(x, y - 15, 8, 4, 0, 0, Math.PI);
            ctx.fill();
        }

        // ë³„ ê·¸ë¦¬ê¸°
        function drawStar(star) {
            ctx.save();
            ctx.translate(star.x, star.y);
            ctx.rotate(star.rotation);

            ctx.fillStyle = '#ffd700';
            ctx.beginPath();
            for (let i = 0; i < 5; i++) {
                const angle = (i * 4 * Math.PI) / 5 - Math.PI / 2;
                const x = Math.cos(angle) * 12;
                const y = Math.sin(angle) * 12;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.closePath();
            ctx.fill();

            // ë°˜ì§ì„
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.arc(-3, -3, 3, 0, Math.PI * 2);
            ctx.fill();

            ctx.restore();
        }

        // ì†ë„ ê°ì†Œ ì•„ì´í…œ ê·¸ë¦¬ê¸°
        function drawSlowItem(item) {
            ctx.save();
            ctx.translate(item.x, item.y);
            ctx.rotate(item.rotation);

            const pulse = 1 + Math.sin(item.pulse) * 0.15;
            ctx.scale(pulse, pulse);

            // ë°”ê¹¥ ì› (íŒŒë€ ê¸€ë¡œìš°)
            ctx.fillStyle = 'rgba(100, 200, 255, 0.3)';
            ctx.beginPath();
            ctx.arc(0, 0, 18, 0, Math.PI * 2);
            ctx.fill();

            // ëˆˆê²°ì • ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#00bfff';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';

            // 6ê°œì˜ ê°€ì§€
            for (let i = 0; i < 6; i++) {
                ctx.save();
                ctx.rotate((i * Math.PI) / 3);

                // ë©”ì¸ ê°€ì§€
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(0, -14);
                ctx.stroke();

                // ì‘ì€ ê°€ì§€
                ctx.beginPath();
                ctx.moveTo(0, -8);
                ctx.lineTo(-4, -12);
                ctx.moveTo(0, -8);
                ctx.lineTo(4, -12);
                ctx.stroke();

                ctx.restore();
            }

            // ì¤‘ì‹¬ ì›
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.arc(0, 0, 4, 0, Math.PI * 2);
            ctx.fill();

            ctx.restore();
        }

        // ë°°ê²½ ê·¸ë¦¬ê¸°
        function drawBackground() {
            // í•˜ëŠ˜
            const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            skyGradient.addColorStop(0, '#87CEEB');
            skyGradient.addColorStop(0.3, '#B0E0E6');
            skyGradient.addColorStop(1, '#E0FFFF');
            ctx.fillStyle = skyGradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ëˆˆ ë°”ë‹¥
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ìŠ¬ë¡œí”„ íš¨ê³¼ (ì¤„ë¬´ëŠ¬)
            ctx.strokeStyle = 'rgba(200, 220, 255, 0.5)';
            ctx.lineWidth = 2;
            const offset = (Date.now() / 20) % 40;
            for (let i = -1; i < canvas.height / 40 + 1; i++) {
                ctx.beginPath();
                ctx.moveTo(0, i * 40 + offset);
                ctx.lineTo(canvas.width, i * 40 + offset);
                ctx.stroke();
            }
        }

        // ìŠ¤í‚¤ ìêµ­ ê·¸ë¦¬ê¸°
        function drawSkiTracks() {
            skiTracks.forEach((track, index) => {
                ctx.strokeStyle = `rgba(200, 210, 220, ${track.opacity})`;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(track.x - 8, track.y);
                ctx.lineTo(track.x - 8, track.y + 10);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(track.x + 8, track.y);
                ctx.lineTo(track.x + 8, track.y + 10);
                ctx.stroke();
            });
        }

        // ëˆˆì†¡ì´ ê·¸ë¦¬ê¸°
        function drawSnowflakes() {
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            snowflakes.forEach(flake => {
                ctx.beginPath();
                ctx.arc(flake.x, flake.y, flake.size, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        // ì—…ë°ì´íŠ¸
        function update() {
            if (!gameRunning) return;

            // ê±°ë¦¬ ì¦ê°€
            distance += speed / 10;

            // ì†ë„ ì ì  ì¦ê°€
            if (distance % 100 < 1) {
                speed = Math.min(speed + 0.5, 20);
            }

            // í”Œë ˆì´ì–´ ì´ë™
            if (keys.left) {
                player.targetX -= 6;
                player.lean = Math.max(player.lean - 0.3, -1);
            } else if (keys.right) {
                player.targetX += 6;
                player.lean = Math.min(player.lean + 0.3, 1);
            } else {
                player.lean *= 0.9;
            }

            player.targetX = Math.max(20, Math.min(canvas.width - 20, player.targetX));
            player.x += (player.targetX - player.x) * 0.15;

            // ìŠ¤í‚¤ ìêµ­ ì¶”ê°€
            if (Math.random() < 0.3) {
                addSkiTrack();
            }

            // ìŠ¤í‚¤ ìêµ­ ì´ë™
            skiTracks.forEach(track => {
                track.y -= speed;
                track.opacity -= 0.01;
            });
            skiTracks = skiTracks.filter(track => track.y > -20 && track.opacity > 0);

            // ì¥ì• ë¬¼ ìƒì„±
            if (Math.random() < 0.02 + speed * 0.002) {
                spawnObstacle();
            }

            // ë³„ ìƒì„±
            if (Math.random() < 0.008) {
                spawnStar();
            }

            // ì†ë„ ê°ì†Œ ì•„ì´í…œ ìƒì„±
            if (Math.random() < 0.005) {
                spawnSlowItem();
            }

            // ì†ë„ ê°ì†Œ íš¨ê³¼ ì²˜ë¦¬
            if (slowEffect > 0) {
                slowEffect--;
                if (slowEffect === 0) {
                    // íš¨ê³¼ ëë‚˜ë©´ ì›ë˜ ì†ë„ë¡œ (í•˜ì§€ë§Œ ìµœì†Œ ì†ë„ ìœ ì§€)
                }
            }

            // ì¥ì• ë¬¼ ì´ë™ ë° ì¶©ëŒ
            obstacles.forEach(obs => {
                obs.y -= speed;
            });
            obstacles = obstacles.filter(obs => obs.y > -60);

            // ì¶©ëŒ ì²´í¬
            for (let obs of obstacles) {
                const obsCenter = { x: obs.x, y: obs.y };
                const playerCenter = { x: player.x, y: player.y + 20 };

                let hitboxWidth = obs.type === 'tree' ? 15 : 20;
                let hitboxHeight = obs.type === 'tree' ? 30 : 15;

                if (Math.abs(playerCenter.x - obsCenter.x) < hitboxWidth &&
                    Math.abs(playerCenter.y - obsCenter.y) < hitboxHeight + 15) {
                    gameOver();
                    return;
                }
            }

            // ë³„ ì´ë™ ë° ìˆ˜ì§‘
            stars.forEach(star => {
                star.y -= speed;
                star.rotation += 0.05;

                if (!star.collected) {
                    const dx = player.x - star.x;
                    const dy = (player.y + 20) - star.y;
                    if (Math.sqrt(dx*dx + dy*dy) < 25) {
                        star.collected = true;
                        distance += 50;
                    }
                }
            });
            stars = stars.filter(star => star.y > -30 && !star.collected);

            // ì†ë„ ê°ì†Œ ì•„ì´í…œ ì´ë™ ë° ìˆ˜ì§‘
            slowItems.forEach(item => {
                item.y -= speed;
                item.rotation += 0.03;
                item.pulse += 0.15;

                if (!item.collected) {
                    const dx = player.x - item.x;
                    const dy = (player.y + 20) - item.y;
                    if (Math.sqrt(dx*dx + dy*dy) < 25) {
                        item.collected = true;
                        speed = Math.max(3, speed - 3); // ì†ë„ 3 ê°ì†Œ (ìµœì†Œ 3)
                        slowEffect = 180; // 3ì´ˆê°„ íš¨ê³¼ í‘œì‹œ
                    }
                }
            });
            slowItems = slowItems.filter(item => item.y > -30 && !item.collected);

            // ëˆˆì†¡ì´ ì´ë™
            snowflakes.forEach(flake => {
                flake.y -= speed * 0.5 + flake.speed;
                flake.x += Math.sin(Date.now() / 500 + flake.y) * 0.5;

                if (flake.y < -10) {
                    flake.y = canvas.height + 10;
                    flake.x = Math.random() * canvas.width;
                }
            });

            updateUI();
        }

        // UI ì—…ë°ì´íŠ¸
        function updateUI() {
            document.getElementById('distance').textContent = Math.floor(distance) + 'm';
            document.getElementById('speed').textContent = speed.toFixed(1);
            document.getElementById('best').textContent = bestScore + 'm';
        }

        // ê·¸ë¦¬ê¸°
        function draw() {
            drawBackground();
            drawSkiTracks();

            // ì¥ì• ë¬¼
            obstacles.forEach(obs => {
                if (obs.type === 'tree') {
                    drawTree(obs.x, obs.y);
                } else {
                    drawRock(obs.x, obs.y);
                }
            });

            // ë³„
            stars.forEach(star => {
                if (!star.collected) drawStar(star);
            });

            // ì†ë„ ê°ì†Œ ì•„ì´í…œ
            slowItems.forEach(item => {
                if (!item.collected) drawSlowItem(item);
            });

            drawPlayer();

            // ì†ë„ ê°ì†Œ íš¨ê³¼ í‘œì‹œ
            if (slowEffect > 0) {
                ctx.fillStyle = 'rgba(100, 200, 255, 0.3)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#00bfff';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('â„ï¸ ì†ë„ ê°ì†Œ! â„ï¸', canvas.width / 2, 30);
            }
            drawSnowflakes();
        }

        // ê²Œì„ ì˜¤ë²„
        function gameOver() {
            gameRunning = false;

            const finalDist = Math.floor(distance);
            if (finalDist > bestScore) {
                bestScore = finalDist;
                localStorage.setItem('skiBest', bestScore.toString());
            }

            document.getElementById('finalDistance').textContent = finalDist + 'm';
            document.getElementById('bestRecord').textContent = bestScore + 'm';
            document.getElementById('gameOver').style.display = 'block';
        }

        // ê²Œì„ ì‹œì‘
        function startGame() {
            document.getElementById('startScreen').style.display = 'none';
            resetGame();
            gameRunning = true;
        }

        // ê²Œì„ ì¬ì‹œì‘
        function restartGame() {
            document.getElementById('gameOver').style.display = 'none';
            resetGame();
            gameRunning = true;
        }

        // ê²Œì„ ë¦¬ì…‹
        function resetGame() {
            distance = 0;
            speed = 5;
            player.x = canvas.width / 2;
            player.targetX = canvas.width / 2;
            player.lean = 0;
            obstacles = [];
            slowItems = [];
            slowEffect = 0;
            stars = [];
            skiTracks = [];
            initSnowflakes();
            updateUI();
        }

        // ê²Œì„ ë£¨í”„
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // í‚¤ë³´ë“œ ì…ë ¥
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') keys.left = true;
            if (e.key === 'ArrowRight') keys.right = true;
        });

        document.addEventListener('keyup', (e) => {
            if (e.key === 'ArrowLeft') keys.left = false;
            if (e.key === 'ArrowRight') keys.right = false;
        });

        // ë²„íŠ¼ ì…ë ¥
        const leftBtn = document.getElementById('leftBtn');
        const rightBtn = document.getElementById('rightBtn');

        leftBtn.addEventListener('mousedown', () => keys.left = true);
        leftBtn.addEventListener('mouseup', () => keys.left = false);
        leftBtn.addEventListener('mouseleave', () => keys.left = false);
        rightBtn.addEventListener('mousedown', () => keys.right = true);
        rightBtn.addEventListener('mouseup', () => keys.right = false);
        rightBtn.addEventListener('mouseleave', () => keys.right = false);

        leftBtn.addEventListener('touchstart', (e) => { e.preventDefault(); keys.left = true; });
        leftBtn.addEventListener('touchend', () => keys.left = false);
        rightBtn.addEventListener('touchstart', (e) => { e.preventDefault(); keys.right = true; });
        rightBtn.addEventListener('touchend', () => keys.right = false);

        // ìº”ë²„ìŠ¤ í„°ì¹˜ ë“œë˜ê·¸ë¡œ ì´ë™ (ëª¨ë°”ì¼)
        let lastTouchX = null;

        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            lastTouchX = touch.clientX;
        });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (lastTouchX === null) return;

            const touch = e.touches[0];
            const deltaX = touch.clientX - lastTouchX;

            // ë“œë˜ê·¸ ë°©í–¥ì— ë”°ë¼ ì´ë™
            if (deltaX < -3) {
                keys.left = true;
                keys.right = false;
            } else if (deltaX > 3) {
                keys.right = true;
                keys.left = false;
            }

            lastTouchX = touch.clientX;
        });

        canvas.addEventListener('touchend', (e) => {
            lastTouchX = null;
            keys.left = false;
            keys.right = false;
        });

        // ì´ˆê¸°í™”
        initSnowflakes();
        updateUI();
        gameLoop();
    </script>
</body>
</html>
